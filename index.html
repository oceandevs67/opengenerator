<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lua AppID Store</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #0b0f1a;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.card {
    width: 420px;
    padding: 20px;
    border-radius: 14px;
    background: #141a2e;
}
input, button {
    width: 100%;
    padding: 12px;
    margin: 6px 0;
}
button { cursor: pointer; }
.hidden { display: none; }
.item {
    padding: 6px;
    border-bottom: 1px solid #2a335a;
}
</style>
</head>

<body>

<div class="card" id="auth">
    <h2>Login</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login / Register</button>
</div>

<div class="card hidden" id="app">
    <button onclick="logout()">Logout</button>

    <h3>Add Game</h3>
    <input id="gameName" placeholder="Game name">
    <input id="appid" placeholder="AppID">
    <button onclick="addGame()">Upload</button>

    <h3>Store</h3>
    <div id="store"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCndVpECQs9gA6cXzr2uttUkV8bxfAdp_s",
  authDomain: "opengeneratorlua.firebaseapp.com",
  projectId: "opengeneratorlua",
  storageBucket: "opengeneratorlua.firebasestorage.app",
  messagingSenderId: "290500738508",
  appId: "1:290500738508:web:785b834ef0ee67673bb169",
  measurementId: "G-LD173LGGPQ"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* AUTH */
auth.onAuthStateChanged(user => {
    document.getElementById("auth").classList.toggle("hidden", !!user);
    document.getElementById("app").classList.toggle("hidden", !user);
    if (user) loadStore();
});

function login() {
    const emailInput = document.getElementById("email").value;
    const passwordInput = document.getElementById("password").value;

    if (!emailInput || !passwordInput) {
        return alert("Please enter email and password");
    }

    auth.signInWithEmailAndPassword(emailInput, passwordInput)
        .catch(() => auth.createUserWithEmailAndPassword(emailInput, passwordInput)
            .catch(err => alert(err.message))
        );
}


function logout() {
    auth.signOut();
}

function addGame() {
    const gameNameInput = document.getElementById("gameName").value.trim();
    const appidInput = document.getElementById("appid").value.trim();
    if (!gameNameInput || !/^\d+$/.test(appidInput)) {
        return alert("Enter valid game name and numeric AppID");
    }

    db.collection("games").add({
        name: gameNameInput,
        appid: appidInput,
        time: Date.now()
    });

    document.getElementById("gameName").value = "";
    document.getElementById("appid").value = "";
}


function loadStore() {
    db.collection("games")
      .orderBy("time", "desc")
      .onSnapshot(snapshot => {
        store.innerHTML = "";
        snapshot.forEach(doc => {
            const g = doc.data();
            store.innerHTML += `
                <div class="item">
                    <b>${g.name}</b><br>
                    AppID: ${g.appid}
                    <button onclick="download('${g.appid}')">Lua</button>
                </div>
            `;
        });
      });
}

function download(appid) {
    const lua = `addappid(${appid})`;
    const blob = new Blob([lua], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `${appid}.lua`;
    a.click();
}
</script>

</body>
</html>
